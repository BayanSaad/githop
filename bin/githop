#!/usr/bin/env ruby

if $PROGRAM_NAME == __FILE__
  ENV['BUNDLE_GEMFILE'] = File.expand_path('../../Gemfile', __FILE__)
  require 'rubygems'
  require 'bundler/setup'
  $LOAD_PATH.unshift File.expand_path('../../lib', __FILE__)
end

require 'githop'

config = YAML.load(File.read("#{ENV['HOME']}/.githop.yml"))
other_user = ARGV.first

result = GitHop.hop(config, other_user)

if result['rows'].nil?
  $stderr.puts "GitHub Archive query for #{other_user || config['github_user']} had no results."
  $stderr.puts result.inspect
  exit(1)
end

result = GitHop.pretty_print(result, other_user)

if result.count == 0
  puts "No events found, but #{other_user || 'you'} surely had an awesome day nevertheless :)"
else
  puts result
end
